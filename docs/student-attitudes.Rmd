---
title: "Student attitudes"
author: "JJ Merelo"
date: "`r Sys.Date()`"
output: html_document
---

Frequency table

```{r setup, echo=FALSE}
library(ggplot2)
library(dplyr)

frecuencias_data <- read.csv("../data/actitudes.csv", header = TRUE, na.strings="", sep = ";")

columnas <- strsplit("ayudan;dependencia-tecnológica;explicaciones-claras;información-segura;manejan-datos;mejorar-habilidades;no-pensamiento-crítico;no-respetan-privacidad;parte-integral;respuestas-confiables;ético", ";")

likert_data <- data.frame( Attitude = character(),
                           Disciplina = character(),
                           Average = numeric(),
                           SD = numeric() );

for ( i in columnas[[1]] ) {
  i <- gsub("-", ".", i)
  frecuencias_uso_data  <-  data.frame(Disciplina = frecuencias_data$Disciplina,
                                       frecuencias_data[i])

  porcentajes_data <-  frecuencias_uso_data %>% group_by(Disciplina,.data[[i]]) %>%
    summarise(Número = n()) 
  porcentajes_data$Likert <- as.numeric( factor( porcentajes_data[[i]],
                                      levels = c("Estoy en desacuerdo", "Más bien en desacuerdo","Ni estoy de acuerdo ni en desacuerdo", "Más bien de acuerdo", "Completamente de acuerdo" )
                                      )
                                )
  
  # compute weighted average of the Likert scale per Disciplina
  promedio_data <- porcentajes_data %>% group_by(Disciplina) %>%
    summarise(Average = sum(Likert * Número) / sum(Número),
              SD = sqrt( sum( Número * (Likert - (sum(Likert * Número) / sum(Número)))^2 ) / sum(Número) )
              )
  
  promedio_data$Attitude <- i
  likert_data <- rbind( likert_data, promedio_data )

}

likert_data$Attitude <- recode( likert_data$Attitude,
                                "ayudan" = "They help",
                                "dependencia.tecnológica" = "Technological dependence",
                                "explicaciones.claras" = "Clear explanations",
                                "información.segura" = "Reliable information",
                                "manejan.datos" = "Handle sensitive data",
                                "mejorar.habilidades"= "Improve skills",
                                "no.pensamiento.crítico"= "Hinder critical thinking",
                                "no.respetan.privacidad"= "Disrespectful of privacy",
                                "parte.integral"= "Integral part of education",
                                "respuestas.confiables"= "Reliable answers",
                                "ético"= "Ethical issues"
                             )
                                

likert_data$Disciplina <- recode( likert_data$Disciplina,
                                 "FFL" = "Language related",
                                 "TIC" = "IT",
                                 "Otras" = "Other"
                                 )


likert_data$average_and_sd <- paste0( round(likert_data$Average,2), " (", round(likert_data$SD,2), ")" )
likert_data$Average <- NULL
likert_data$SD <- NULL


library(tidyr)

likert_data %>%
  pivot_wider(names_from = Disciplina, values_from = average_and_sd, id_cols= Attitude) -> likert_table

likert_table <- likert_table[,c(1,2,4,3)]

library(kableExtra)
kable( likert_table,
       align="c" )  %>%
  column_spec(1, bold = TRUE, width="15em") %>%
  row_spec(0, bold = TRUE, background = "#D3D3D3")
```
