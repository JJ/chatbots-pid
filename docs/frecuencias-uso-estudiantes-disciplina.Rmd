---
title: "uso-chatbots-docentes"
author: "JJ Merelo"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup,  echo=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)

frecuencias_data <- read.csv("../data/frecuencias-uso.csv", header = TRUE, na.strings="", sep = ";")

columnas <- strsplit("administrativas;burocracia;calendario;comunicacion-profesorado;feedback;generar-material;preguntas-temario;preparar-examen;profesor-particular;resumen;traduccion", ";")

resultados_uso <- data.frame( uso=character(),
                              disciplina = character(),
                              frecuencia=character(),
                              respuestas=numeric(),
                              porcentaje = numeric() );

for ( i in columnas[[1]] ) {
  i <- gsub("-", ".", i)

  porcentajes_data <-  frecuencias_data %>% drop_na() %>% group_by(Disciplina,.data[[i]]) %>%
  summarise(Responses = n()) %>%
  mutate(Percentage = Responses / sum(Responses))

  porcentajes_data$Frecuencia <- factor(porcentajes_data[[i]],
                                        levels = c("No me parece útil", "Me gustaría hacerlo", "Lo he hecho"))

  for (j in 1:nrow(porcentajes_data) ) {
      resultados_uso <- rbind( resultados_uso,
                               data.frame( uso = i,
                                          frequency = porcentajes_uso[j]$Percentaje,
                                          discipline = porcentajes_uso[j]$Disciplina,
                                          
      )
    }

  }
}

resultados_uso$uso <- factor(resultados_uso$uso,
                             levels = resultados_uso %>%
                               filter(frecuencia == "Lo he hecho") %>%
                               arrange(porcentaje) %>% pull(uso)
                             )
translated_labels <- c("Interaction w/ teachers",
                               "Calendar",
                               "Administration",
                               "Bureaucracy",
                               "Help with feedback",
                               "Private tutor",
                               "Summarizing texts",
                       "Answer syllabus questions",
                               "Generate material",
                               "Preparing exams",
                               "Translate texts")  
ggplot(resultados_uso, aes(x=uso, fill=frecuencia, y = porcentaje)) +
  geom_bar( stat="identity", position="dodge") +
  labs(title="Students's use of chatbots", x="Application", y="Proportion") +
  scale_x_discrete( labels = translated_labels ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
```

The same data in a table

```{r tabla, echo=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)
resultados_uso$porcentaje <- NULL
resultados_uso %>%
  pivot_wider(names_from = frecuencia, values_from = respuestas) %>%
  arrange(desc(`Lo he hecho`)) %>%
  kable( digits=2,
         col.names = c("Application", "It's not useful", "I'd like to do it", "I've done it"),
         caption = "How often I have used chatbots for this purpose",
  ) %>%
  kable_styling( full_width = FALSE )
```
