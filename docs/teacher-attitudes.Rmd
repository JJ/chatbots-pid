---
title: "Teacher attitudes"
author: "JJ Merelo"
date: "`r Sys.Date()`"
output: html_document
---

Frequency table

```{r setup, echo=FALSE}
library(ggplot2)
library(dplyr)

frecuencias_data <- read.csv("../data/actitudes-docentes.csv", header = TRUE, na.strings="", sep = ";")

columnas <- strsplit("ayudan;dependencia-tecnol√≥gica;explicaciones-claras;informaci√≥n-segura;manejan-datos;mejorar-habilidades;no-pensamiento-cr√≠tico;no-respetan-privacidad;parte-integral;respuestas-confiables;√©tico", ";")

likert_data <- data.frame( Attitude = character(),
                           Disciplina = character(),
                           Average = numeric(),
                           SD = numeric() )

opiniones_data <- data.frame( Attitude = character(),
                              Disciplina = character(),
                              Response = character(),
                              Count = numeric(),
                              Percentage = numeric() )

opiniones_resumen_data <- data.frame( Attitude = character(),
                                      Response = character(),
                                      Count = numeric(),
                                      Percentage = numeric() )

for ( i in columnas[[1]] ) {
  i <- gsub("-", ".", i)
  frecuencias_uso_data  <-  data.frame(Disciplina = frecuencias_data$Disciplina,
                                       frecuencias_data[i])

  porcentajes_data <-  frecuencias_uso_data %>% group_by(Disciplina,.data[[i]]) %>%
    summarise(Count = n())  %>% 
    mutate( Percentage = Count / sum(Count) * 100 )
  
  porcentajes_data$Response <- porcentajes_data[[i]]
  porcentajes_data$Attitude <- i
  opiniones_data <- rbind( opiniones_data, porcentajes_data )
  
  porcentajes_absolutos_data <-  frecuencias_uso_data %>% group_by(.data[[i]]) %>%
    summarise(Count = n())  %>% 
    mutate( Percentage = Count / sum(Count) * 100 )
  
  porcentajes_absolutos_data$Response <- porcentajes_absolutos_data[[i]]
  porcentajes_absolutos_data$Attitude <- i
  porcentajes_absolutos_data[[i]] <- NULL
  
  opiniones_resumen_data <- rbind( opiniones_resumen_data, porcentajes_absolutos_data )
  
  porcentajes_data$Likert <- as.numeric( factor( porcentajes_data[[i]],
                                      levels = c("Estoy en desacuerdo", "M√°s bien en desacuerdo","Ni estoy de acuerdo ni en desacuerdo", "M√°s bien de acuerdo", "Completamente de acuerdo" )
                                      )
                                )
  
  # compute weighted average of the Likert scale per Disciplina
  promedio_data <- porcentajes_data %>% group_by(Disciplina) %>%
    summarise(Average = sum(Likert * Count) / sum(Count),
              SD = sqrt( sum( Count * (Likert - (sum(Likert * Count) / sum(Count)))^2 ) / sum(Count) )
              )
  
  frecuencia_tabla <- table( unname(unlist(frecuencias_uso_data[i])), frecuencias_uso_data$Disciplina)
  chisq_frecuencia <- chisq.test(frecuencia_tabla)
  if ( chisq_frecuencia$p.value < 0.05 ) {
    cat("‚úÖ La prueba de chi-cuadrado indica que hay una diferencia significativa en la actitud üìà", i, "üìà con p-value ", chisq_frecuencia$p.value,"\n")
  }
  
  promedio_data$Attitude <- i
  likert_data <- rbind( likert_data, promedio_data )

}

opiniones_resumen_data$Attitude <- recode( opiniones_resumen_data$Attitude,
                                "ayudan" = "They help",
                                "dependencia.tecnol√≥gica" = "Technological dependence",
                                "explicaciones.claras" = "Clear explanations",
                                "informaci√≥n.segura" = "Secure information",
                                "manejan.datos" = "Handle sensitive data",
                                "mejorar.habilidades"= "Improve skills",
                                "no.pensamiento.cr√≠tico"= "Hinder critical thinking",
                                "no.respetan.privacidad"= "Disrespectful of privacy",
                                "parte.integral"= "Integral part of education",
                                "respuestas.confiables"= "Reliable answers",
                                "√©tico"= "Ethical issues"
                             )
opiniones_resumen_data$Response <- recode( opiniones_resumen_data$Response,
                                "Estoy en desacuerdo" = "Strongly disagree",
                                "M√°s bien en desacuerdo" = "Somewhat disagree",
                                "Ni estoy de acuerdo ni en desacuerdo" = "Neutral",
                                "M√°s bien de acuerdo" = "Somewhat agree",
                                "Completamente de acuerdo" = "Strongly agree"
                             )


opiniones_resumen_data$Response <- factor( opiniones_resumen_data$Response,
                                      levels = c("Strongly disagree", "Somewhat disagree", "Neutral", "Somewhat agree", "Strongly agree" )
                                      )

opiniones_resumen_data$Attitude <- factor(opiniones_resumen_data$Attitude,
                                          levels = opiniones_resumen_data %>%
                                          filter(Response == "Somewhat agree") %>%
                                          arrange(Percentage) %>% pull(Attitude)
)


ggplot( opiniones_resumen_data, aes(x=Attitude, y = Percentage, fill=Response)) +
  geom_bar( stat="identity", position="dodge") +
  labs(title=paste0("Teacher's opinions and attitudes towards AI"), x="Question", y="Percentage") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

ggplot( opiniones_data, aes(x=Response, fill=Disciplina, y = Percentage)) +
  geom_bar( stat="identity", position="dodge") +
  labs(title=paste0("Actitudes de los docentes sobre IA"), x="Frecuencia", y="Proporci√≥n") +
  facet_wrap( ~ Attitude ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

likert_data$Attitude <- recode( likert_data$Attitude,
                                "ayudan" = "They help",
                                "dependencia.tecnol√≥gica" = "Technological dependence",
                                "explicaciones.claras" = "Clear explanations",
                                "informaci√≥n.segura" = "Reliable information",
                                "manejan.datos" = "Handle sensitive data",
                                "mejorar.habilidades"= "Improve skills",
                                "no.pensamiento.cr√≠tico"= "Hinder critical thinking",
                                "no.respetan.privacidad"= "Disrespectful of privacy",
                                "parte.integral"= "Integral part of education",
                                "respuestas.confiables"= "Reliable answers",
                                "√©tico"= "Ethical issues"
                             )
                                

likert_data$Disciplina <- recode( likert_data$Disciplina,
                                 "TIC" = "ICT",
                                 "Otras" = "Other"
                                 )


likert_data$average_and_sd <- paste0( round(likert_data$Average,2), " (", round(likert_data$SD,2), ")" )
likert_data$Average <- NULL
likert_data$SD <- NULL


library(tidyr)

likert_data %>%
  pivot_wider(names_from = Disciplina, values_from = average_and_sd, id_cols= Attitude) -> likert_table

likert_table <- likert_table[,c(1,3,2)]

library(kableExtra)
kable( likert_table,
       align="c" )  %>%
  column_spec(1, bold = TRUE, width="15em") %>%
  row_spec(0, bold = TRUE, background = "#D3D3D3")
```
